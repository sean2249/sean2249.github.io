<!doctype html><html lang=en-us><head><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Weekly_04","datePublished":"2022-03-02T19:24:34+08:00","dateModified":"2022-03-02T19:24:34+08:00","author":{"@type":"Person","name":"Kiwi Lee","image":"https://www.gravatar.com/avatar/0d1e46158977211ef53c1d7c007415f6"},"mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/sean2249.github.io\/posts\/weekly_04\/"},"publisher":{"@type":"Organization","name":"Kiwi's Blog","logo":{"@type":"ImageObject","url":"https://www.gravatar.com/avatar/0d1e46158977211ef53c1d7c007415f6"}},"description":"2022/02/20 ~ 2022/02/26; åª git add éƒ¨ä»½çš„ file changed/è»Ÿé«”å·¥ç¨‹å¸«çš„é–±è®€æ›¸å–®/kubernetes çš„å…ƒä»¶ç°¡æ˜“ä»‹ç´¹/Reverse emoji in python is not what u think","keywords":["development, taiwan, python"]}</script><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=generator content="Hugo 0.81.0 with theme Tranquilpeak 0.5.3-BETA"><meta name=author content="Kiwi Lee"><meta name=keywords content=",development,taiwan,python"><meta name=description content="2022/02/20 ~ 2022/02/26; åª git add éƒ¨ä»½çš„ file changed/è»Ÿé«”å·¥ç¨‹å¸«çš„é–±è®€æ›¸å–®/kubernetes çš„å…ƒä»¶ç°¡æ˜“ä»‹ç´¹/Reverse emoji in python is not what u think"><meta property="og:description" content="2022/02/20 ~ 2022/02/26; åª git add éƒ¨ä»½çš„ file changed/è»Ÿé«”å·¥ç¨‹å¸«çš„é–±è®€æ›¸å–®/kubernetes çš„å…ƒä»¶ç°¡æ˜“ä»‹ç´¹/Reverse emoji in python is not what u think"><meta property="og:type" content="article"><meta property="og:title" content="Weekly_04"><meta name=twitter:title content="Weekly_04"><meta property="og:url" content="https://sean2249.github.io/posts/weekly_04/"><meta property="twitter:url" content="https://sean2249.github.io/posts/weekly_04/"><meta property="og:site_name" content="Kiwi's Blog"><meta property="og:description" content="2022/02/20 ~ 2022/02/26; åª git add éƒ¨ä»½çš„ file changed/è»Ÿé«”å·¥ç¨‹å¸«çš„é–±è®€æ›¸å–®/kubernetes çš„å…ƒä»¶ç°¡æ˜“ä»‹ç´¹/Reverse emoji in python is not what u think"><meta name=twitter:description content="2022/02/20 ~ 2022/02/26; åª git add éƒ¨ä»½çš„ file changed/è»Ÿé«”å·¥ç¨‹å¸«çš„é–±è®€æ›¸å–®/kubernetes çš„å…ƒä»¶ç°¡æ˜“ä»‹ç´¹/Reverse emoji in python is not what u think"><meta property="og:locale" content="zh-tw"><meta property="article:published_time" content="2022-03-02T19:24:34"><meta property="article:modified_time" content="2022-03-02T19:24:34"><meta property="article:section" content="weekly"><meta property="article:tag" content="weekly"><meta name=twitter:card content="summary"><meta property="og:image" content="https://www.gravatar.com/avatar/0d1e46158977211ef53c1d7c007415f6?s=640"><meta property="twitter:image" content="https://www.gravatar.com/avatar/0d1e46158977211ef53c1d7c007415f6?s=640"><title>Weekly_04</title><link rel=icon href=https://sean2249.github.io/favicon.png><link rel=canonical href=https://sean2249.github.io/posts/weekly_04/><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css integrity="sha512-iBBXm8fW90+nuLcSKlbmrPcLa0OT92xO1BIsZ+ywDWZCvqsWgccV3gFoRBv0z+8dLJgyAHIhR35VZc2oM/gI1w==" crossorigin=anonymous referrerpolicy=no-referrer><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.7/jquery.fancybox.min.css integrity="sha512-H9jrZiiopUdsLpg94A333EfumgUBpO9MdbxStdeITo+KEIMaNfHNvwyjjDJb+ERPaRS6DpyRlKbvPUasNItRyw==" crossorigin=anonymous referrerpolicy=no-referrer><link rel=stylesheet href=https://sean2249.github.io/css/style-h6ccsoet3mzkbb0wngshlfbaweimexgqcxj0h5hu4h82olsdzz6wmqdkajm.min.css></head><body><div id=blog><header id=header data-behavior=5><i id=btn-open-sidebar class="fa fa-lg fa-bars"></i><div class=header-title><a class=header-title-link href=https://sean2249.github.io/ aria-label=å»é¦–é >Kiwi's Blog</a></div><a class=header-right-picture href=https://sean2249.github.io/#about aria-label="æ‰“é–‹éˆæ¥: /#about"><img class=header-picture src="https://www.gravatar.com/avatar/0d1e46158977211ef53c1d7c007415f6?s=90" alt=ä½œè€…çš„åœ–ç‰‡></a></header><nav id=sidebar data-behavior=5><div class=sidebar-container><div class=sidebar-profile><a href=https://sean2249.github.io/#about aria-label=é–±è®€æœ‰é—œä½œè€…çš„æ›´å¤šä¿¡æ¯><img class=sidebar-profile-picture src="https://www.gravatar.com/avatar/0d1e46158977211ef53c1d7c007415f6?s=110" alt=ä½œè€…çš„åœ–ç‰‡></a><h4 class=sidebar-profile-name>Kiwi Lee</h4><h5 class=sidebar-profile-bio>Python engineer/Devops</h5></div><ul class=sidebar-buttons><li class=sidebar-button><a class=sidebar-button-link href=https://sean2249.github.io/ title=Home><i class="sidebar-button-icon fas fa-lg fa-home" aria-hidden=true></i><span class=sidebar-button-desc>é¦–é </span></a></li><li class=sidebar-button><a class=sidebar-button-link href=https://sean2249.github.io/categories title=Categories><i class="sidebar-button-icon fas fa-lg fa-bookmark" aria-hidden=true></i><span class=sidebar-button-desc>åˆ†é¡</span></a></li><li class=sidebar-button><a class=sidebar-button-link href=https://sean2249.github.io/tags title=Tags><i class="sidebar-button-icon fas fa-lg fa-tags" aria-hidden=true></i><span class=sidebar-button-desc>æ¨™ç±¤</span></a></li><li class=sidebar-button><a class=sidebar-button-link href=https://sean2249.github.io/archives title=Archives><i class="sidebar-button-icon fas fa-lg fa-archive" aria-hidden=true></i><span class=sidebar-button-desc>æ‰€æœ‰æ–‡ç« </span></a></li><li class=sidebar-button><a class=sidebar-button-link href=https://sean2249.github.io/#about title=About><i class="sidebar-button-icon fas fa-lg fa-question" aria-hidden=true></i><span class=sidebar-button-desc>é—œæ–¼</span></a></li></ul><ul class=sidebar-buttons><li class=sidebar-button><a class=sidebar-button-link href=https://github.com/sean2249 target=_blank rel=noopener title=GitHub><i class="sidebar-button-icon fab fa-lg fa-github" aria-hidden=true></i><span class=sidebar-button-desc>GitHub</span></a></li><li class=sidebar-button><a class=sidebar-button-link href=https://medium.com/@sean22492249 target=_blank rel=noopener title=Medium><i class="sidebar-button-icon fab fa-lg fa-brands fa-medium" aria-hidden=true></i><span class=sidebar-button-desc>Medium</span></a></li></ul><ul class=sidebar-buttons></ul></div></nav><div id=main data-behavior=5 class=hasCoverMetaIn><article class=post id=top><div class="post-header main-content-wrap text-left"><h1 class=post-title>Weekly_04</h1><div class="postShorten-meta post-meta"><time datetime=2022-03-02T19:24:34+08:00>ä¸‰æœˆ 2, 2022</time>
<span>åˆ†é¡</span>
<a class=category-link href=https://sean2249.github.io/categories/weekly>weekly</a></div></div><div class="post-content markdown"><div class=main-content-wrap><p>é€™å‘¨æŠŠé›»è…¦çš„æ‰€æœ‰ tab æ¸…ç©º!!!!</p><ul><li><a href=#link>Link</a><ul><li><a href=#good>Good</a><ul><li><a href=#git-commit-only-part-of-a-file-in-git>[git] Commit only part of a file in git</a></li><li><a href=#python-which-string-formatting-method-should-you-use>[python] Which string formatting method should you use</a><ul><li><a href=#1-%E4%BD%BF%E7%94%A8->1. ä½¿ç”¨ %</a></li><li><a href=#2-%E4%BD%BF%E7%94%A8-format>2. ä½¿ç”¨ format</a></li><li><a href=#3-%E4%BD%BF%E7%94%A8-f-string>3. ä½¿ç”¨ f-string</a></li><li><a href=#4-%E4%BD%BF%E7%94%A8-template-%E6%A5%B5%E5%B0%91%E8%A6%8B>4. ä½¿ç”¨ Template (æ¥µå°‘è¦‹)</a></li></ul></li><li><a href=#fastapi-%E5%AE%98%E6%96%B9%E6%8F%90%E4%BE%9B%E7%9A%84-fastapi-%E5%B0%88%E6%A1%88%E6%9E%B6%E6%A7%8B>[FastAPI] å®˜æ–¹æä¾›çš„ fastapi å°ˆæ¡ˆæ¶æ§‹</a></li><li><a href=#software-software-engineer-roadmap-via-books>[Software] Software Engineer roadmap via books</a><ul><li><a href=#1-%E5%BF%83%E6%B3%95>1. å¿ƒæ³•</a></li><li><a href=#2-%E5%9F%BA%E7%A4%8E>2. åŸºç¤</a></li><li><a href=#3-%E9%80%B2%E9%9A%8E>3. é€²éš</a></li><li><a href=#4-%E5%8F%8D%E8%A6%86%E9%96%B1%E8%AE%80>4. åè¦†é–±è®€</a></li></ul></li><li><a href=#pytest-useful-pytest-command-line-options>[Pytest] Useful pytest command line options</a></li><li><a href=#python-class-provide-multiple-constructors-in-your-python-classes>[python-class] Provide Multiple Constructors in Your Python Classes</a></li><li><a href=#kubernetes-a-guide-to-kubernetes-architecture>[Kubernetes] A guide to Kubernetes architecture</a></li><li><a href=#python-string-encode-why-cant-you-reverse-a-string-with-a-flag-emoji>[Python-string-encode] Why Canâ€™t You Reverse a String With a Flag Emoji?</a></li></ul></li><li><a href=#others>Others</a><ul><li><a href=#python-what-does--noqa-mean-in-python-comments>[python] What does &lsquo;# noqa&rsquo; mean in Python comments</a></li><li><a href=#mock-mocking-a-class-used-in-a-with-statement>[mock] Mocking a class used in a with statement</a></li><li><a href=#python-psycopg2-where-in-statement-parameters>[python] psycopg2 where in statement parameters</a></li><li><a href=#kubernetes-%E7%AC%AC%E4%B8%80%E5%8D%83%E9%9B%B6%E4%B8%80%E7%AF%87%E7%9A%84-cgroups-%E4%BB%8B%E7%B4%B9>[kubernetes] ç¬¬ä¸€åƒé›¶ä¸€ç¯‡çš„ cgroups ä»‹ç´¹</a></li><li><a href=#fastapi-events-startup---shutdown>[FastAPI] events: startup - shutdown</a></li><li><a href=#fastapi-request-body--path--query-parameters>[FastAPI] Request body + path + query parameters</a></li><li><a href=#fastapi-body-with-multiple-examples>[FastAPI] <code>Body</code> with multiple <code>examples</code></a></li><li><a href=#fastapi-middleware>[FastAPI] middleware</a></li><li><a href=#designpattern-wiki-%E4%B8%8A%E9%9D%A2%E7%9A%84-design-pattern>[DesignPattern] Wiki ä¸Šé¢çš„ design pattern</a></li><li><a href=#systemstructure-uml>[SystemStructure] UML</a></li><li><a href=#psycopg2-sqlstate-exception-classes>[psycopg2] Sqlstate exception classes</a></li></ul></li></ul></li><li><a href=#notes>Notes</a><ul><li><a href=#regular-expression-%E5%8F%96%E5%87%BA>Regular expression å–å‡º</a></li><li><a href=#mock-setting-return-values-and-attributes>[Mock] setting return values and attributes</a><ul><li><a href=#set-function-return-value>set function return value</a></li><li><a href=#set-module-return-value>Set module return value</a></li><li><a href=#set-attribute-value>set attribute value</a></li><li><a href=#use-class-instance>use class instance</a></li></ul></li><li><a href=#fastapi-additional-responses-in-openapi>[FastAPI] Additional responses in OpenAPI</a></li></ul></li></ul><h1 id=link>Link</h1><h2 id=good>Good</h2><h3 id=git-commit-only-part-of-a-file-in-git>[git] Commit only part of a file in git</h3><p><a href=https://stackoverflow.com/questions/1085162/commit-only-part-of-a-file-in-git>https://stackoverflow.com/questions/1085162/commit-only-part-of-a-file-in-git</a></p><p><code>git add</code> é è¨­æœƒå°‡æª”æ¡ˆæœ‰ä¿®æ”¹çš„åœ°æ–¹éƒ½åŠ å…¥åˆ° staging areaï¼Œä½†æœ‰æ™‚æœƒæƒ³åˆ†é–‹æˆå…©å€‹ commit ä¸Šå‚³ï¼Œæˆ–æ˜¯é‡å°å¦ä¸€å€‹ä¿®æ”¹çš„åœ°æ–¹åšå›å¾©</p><p><code>git add --patch &lt;filename></code> å¯ä»¥è®“ git é‡å°æ¯ä¸€å¡Šä¿®æ”¹çš„åœ°æ–¹ï¼Œè®“ä½ é¸æ“‡è¦ä½œç‚º commit é‚„æ˜¯æ”¾æ£„ä½œç‚º commit</p><p>è€Œé€™ç¯‡å°±æ˜¯åœ¨èªªæ˜é¸é …çš„å…¨åæ˜¯ä»€éº¼XDDD å› ç‚º git è£¡é¢å¯«çš„æ˜¯ç¸®å¯«</p><h3 id=python-which-string-formatting-method-should-you-use>[python] Which string formatting method should you use</h3><p><a href=https://realpython.com/python-string-formatting/#which-string-formatting-method-should-you-use>https://realpython.com/python-string-formatting/#which-string-formatting-method-should-you-use</a></p><p>python string format æœ‰å››ç¨®</p><h4 id=1-ä½¿ç”¨->1. ä½¿ç”¨ %</h4><p>å¾ C çš„ prinft å°å…¥éä¾†çš„</p><pre><code class="language-python=" data-lang="python=">&gt;&gt;&gt; name = 'bob'
&gt;&gt;&gt; 'hello %s' % name
hello bob
</code></pre><h4 id=2-ä½¿ç”¨-format>2. ä½¿ç”¨ format</h4><p>é€™æ‡‰è©²æ˜¯ python3.5 å‰å¾ˆå¸¸ç”¨çš„æ–¹æ³•ï¼Œä¸éå¾ˆæ…¢</p><pre><code class="language-python=" data-lang="python=">&gt;&gt;&gt; name = 'bob'
&gt;&gt;&gt; 'hello {}'.format(name)
hello bob
</code></pre><h4 id=3-ä½¿ç”¨-f-string>3. ä½¿ç”¨ f-string</h4><p>python3.6 å°å…¥ï¼Œå”¯ä¸€æ¨è–¦</p><pre><code class="language-python=" data-lang="python=">&gt;&gt;&gt; name = 'bob'
&gt;&gt;&gt; f'hello {name}'
hello bob
</code></pre><h4 id=4-ä½¿ç”¨-template-æ¥µå°‘è¦‹>4. ä½¿ç”¨ Template (æ¥µå°‘è¦‹)</h4><p>éœ€è¦é¡å¤– import</p><pre><code class="language-python=" data-lang="python=">&gt;&gt;&gt; from string import Template
&gt;&gt;&gt; t = Template('hello $name')
&gt;&gt;&gt; t.substitue(name=name)
hello bob
</code></pre><p>æ•´é«”é€Ÿåº¦ï¼Œå°è±¡ä¸­æ˜¯ f-string > % > format > Template
Template çš„å¥½è™•åœ¨æ–¼å¯ä»¥çµ¦ user å®šç¾©å¥å­ï¼Œå…¶ä»–å°±æ²’äº†
æ­£å¸¸ä¸Šé™¤äº†ä½ çš„ python å°æ–¼ 3.6ï¼Œä¸ç„¶éƒ½ä¸€å¾‹æ¨ f-string</p><h3 id=fastapi-å®˜æ–¹æä¾›çš„-fastapi-å°ˆæ¡ˆæ¶æ§‹>[FastAPI] å®˜æ–¹æä¾›çš„ fastapi å°ˆæ¡ˆæ¶æ§‹</h3><p><a href=https://github.com/tiangolo/full-stack-fastapi-postgresql>https://github.com/tiangolo/full-stack-fastapi-postgresql</a></p><p>åŒ…å«äº†å‰ç«¯ Vueï¼Œå¾Œç«¯ Fastapiï¼ŒDatabase Postgres</p><h3 id=software-software-engineer-roadmap-via-books>[Software] Software Engineer roadmap via books</h3><p><a href=https://medium.com/@iamjwr/software-engineer-roadmap-via-books-a6aabdc2589c>https://medium.com/@iamjwr/software-engineer-roadmap-via-books-a6aabdc2589c</a></p><h4 id=1-å¿ƒæ³•>1. å¿ƒæ³•</h4><ol><li>The Passionate Programmer</li><li>Building a career in software</li></ol><h4 id=2-åŸºç¤>2. åŸºç¤</h4><ul><li>Elements of Computing Systems</li><li>You Donâ€™t Know JS</li></ul><h4 id=3-é€²éš>3. é€²éš</h4><ul><li>Grokking Algorithms</li><li>Design Patterns</li><li>Test-Driven Development by Example</li><li>Clean Code</li></ul><h4 id=4-åè¦†é–±è®€>4. åè¦†é–±è®€</h4><ul><li>Explain the Cloud Like Iâ€™m 10</li><li>System Design Interview</li><li>Designing Data-Intensive Applications</li><li>Domain-Driven Development Distilled</li></ul><h3 id=pytest-useful-pytest-command-line-options>[Pytest] Useful pytest command line options</h3><p><a href=https://www.thedigitalcatonline.com/blog/2018/07/05/useful-pytest-command-line-options/>https://www.thedigitalcatonline.com/blog/2018/07/05/useful-pytest-command-line-options/</a></p><p>ä¸»è¦æ˜¯ä»‹ç´¹ pytest skip çš„åŠŸèƒ½</p><p>ç°¡å–®çš„ skipï¼Œåªè¦åŠ ä¸Š decorator å³å¯</p><pre><code class="language-python=" data-lang="python=">@pytest.mark.skip
def test_a():
    ...
</code></pre><p>åŠ å…¥ reasonï¼Œä½¿ pytest é‹è¡Œåˆ°æ­¤ test æœƒå¤šå°äº›è³‡è¨Š</p><pre><code class="language-python=" data-lang="python=">@pytest.mark.skip(reason='I want to skip')
def test_b():
    ...
</code></pre><p>åŠ å…¥æ¢ä»¶åˆ¤æ–·</p><pre><code class="language-python=" data-lang="python=">@pytest.mark.skipif(os.environ['AWS_REGION'] == 'us-west-2', reason='I want to skip')
def test_b():
    ...
</code></pre><p>æ¨™ç±¤ testï¼Œå¯æŒ‡å®šè¦è·‘è·Ÿä¸è·‘çš„</p><pre><code class="language-python=" data-lang="python=">@pytest.mark.slow
def test_slow():
    ...
</code></pre><p>ä¸‹é¢æŒ‡ä»¤æœƒåªé‹è¡Œæœ‰æ¨™è¨»ç‚º <code>slow</code> çš„ test</p><pre><code class="language-shell=" data-lang="shell=">$ pytest -m slow
</code></pre><p>æˆ–æ˜¯ä½ ä¸æƒ³é‹è¡Œ slow</p><pre><code class="language-shell=" data-lang="shell=">$ pytest -m 'not slow'
</code></pre><p>æˆ–æ˜¯æ›´è¯éº—çš„ï¼Œslow or fast éƒ½è·‘</p><pre><code class="language-shell=" data-lang="shell=">$ pytest -m 'slow or fast'
</code></pre><p>ä¸Šé¢éƒ½æ˜¯é‡å° test function ä¾†åšï¼Œä¸‹é¢å‰‡æ˜¯ä¸åŒçš„æ–¹å¼ skip</p><p>è·‘åˆ°ä¸€åŠ skip</p><pre><code class="language-python=" data-lang="python=">def test_function():
    if not valid_config():
        pytest.skip(&quot;unsupported configuration&quot;)
</code></pre><p>è¼‰å…¥ module æ™‚ï¼Œskip æ•´å€‹ module</p><pre><code class="language-python=" data-lang="python=">import sys
import pytest

if not sys.platform.startswith(&quot;win&quot;):
    pytest.skip(&quot;skipping windows-only tests&quot;, allow_module_level=True)
</code></pre><h3 id=python-class-provide-multiple-constructors-in-your-python-classes>[python-class] Provide Multiple Constructors in Your Python Classes</h3><p><a href=https://realpython.com/python-multiple-constructors/>https://realpython.com/python-multiple-constructors/</a></p><ul><li><code>__new__</code> object creation</li><li><code>__init__</code> object initialization</li><li>python æ²’æœ‰ç›´æ¥æ”¯æ´ overloading (æ–‡ä¸­æœ‰å¯«åŸå› )</li></ul><p><a href=https://stackoverflow.com/questions/6434482/python-function-overloading>Python function overloading</a>: åˆ©ç”¨ module::multipledispatch ä¾†å¯¦ç¾</p><ul><li><code>__call__</code> åœ¨å¯¦é«”åŒ–çš„ç›´æ¥å‘¼å«</li></ul><pre><code class="language-python=" data-lang="python=">&gt;&gt;&gt; class Person:
...     def __init__(self, name):
...         self.name = name
...         
...     def __call(self):
...         print(f&quot;I'm {self.name}&quot;)

&gt;&gt;&gt; person = Person('kiwi')
&gt;&gt;&gt; person()
I'm kiwi
</code></pre><p>æ–‡ç« æ¥ä¸‹ä¾†éƒ½æ˜¯ classmethod çš„ä»‹ç´¹ï¼Œå¯ä»¥åƒè€ƒä¸€ä¸‹ï¼Œæ›´å¯é †ä¾¿è·Ÿ staticmethod åšå€‹æ¯”è¼ƒ</p><p><a href="https://docs.python.org/dev/library/stdtypes.html?highlight=strip#dict.fromkeys"><code>dict.fromkeys(iterable)</code></a> !! åœ¨å·²çŸ¥ key çš„æ™‚å€™å¯ä»¥å…ˆè¨­å®š default value ç”¢å‡ºæ–°çš„ dictionary</p><pre><code class="language-python=" data-lang="python=">&gt;&gt;&gt; names = ['Alice', 'Bob', 'Cindy']
&gt;&gt;&gt; bank_accounts = dict.fromkeys(names, 0)
&gt;&gt;&gt; bank_accounts
{'Alice': 0, 'Bob': 0, 'Cindy': 0}
</code></pre><p>é‚„æœ‰å…¶ä»– classmethod åœ¨åŸºæœ¬çš„ datatypeï¼Œåƒæ˜¯ int, float</p><p>datetime ä¹Ÿæ˜¯ä¸€å † classmethod</p><pre><code class="language-python=" data-lang="python=">&gt;&gt;&gt; from datetime import date
&gt;&gt;&gt; from time import time

&gt;&gt;&gt; # Standard constructor
&gt;&gt;&gt; date(2022, 1, 13)
datetime.date(2022, 1, 13)

&gt;&gt;&gt; date.today()
datetime.date(2022, 1, 13)

&gt;&gt;&gt; date.fromtimestamp(1642110000)
datetime.date(2022, 1, 13)
&gt;&gt;&gt; date.fromtimestamp(time())
datetime.date(2022, 1, 13)

&gt;&gt;&gt; date.fromordinal(738168)
datetime.date(2022, 1, 13)

&gt;&gt;&gt; date.fromisoformat(&quot;2022-01-13&quot;)
datetime.date(2022, 1, 13)
</code></pre><p>çœ‹åˆ°äº†ä¸€å€‹æ–°æ½®çš„ç©æ„å…’: åœ¨ python3.8 å¾Œï¼Œæ–°å¢äº† <code>@singledispatch</code> / <code>@singledispatchmethod</code> åœ¨ functools</p><p>æ„Ÿè¦ºå¯¦ç¾äº† overloading</p><pre><code class="language-python=" data-lang="python="># demo.py

from functools import singledispatchmethod

class DemoClass:
    @singledispatchmethod
    def generic_method(self, arg):
        print(f&quot;Do something with argument of type: {type(arg).__name__}&quot;)

    @generic_method.register
    def _(self, arg: int):
        print(&quot;Implementation for an int argument...&quot;)

    @generic_method.register(str)
    def _(self, arg):
        print(&quot;Implementation for a str argument...&quot;)
</code></pre><p>åˆ©ç”¨ <code>@singledispatchmethod</code> åšç™»è¨˜ï¼Œä»£è¡¨æ­¤ method æ˜¯ defaultã€‚æ¥ä¸‹ä¾†åœ¨ç”¨é€™å€‹ method ç•¶åš decorator å» register ä¸åŒ argument type çš„ methodï¼Œç•¶ä½œ overloading</p><p>ä½ å¯ä»¥ç›´æ¥æ¨™æ³¨æ ¼å¼åœ¨ register å…§ï¼Œæˆ–æ˜¯ç”¨ type annotation</p><p>å‘¼å«çš„æ„Ÿè¦ºæ˜¯</p><pre><code class="language-python=" data-lang="python=">&gt;&gt;&gt; from demo import DemoClass

&gt;&gt;&gt; demo = DemoClass()

&gt;&gt;&gt; demo.generic_method(42)
Implementation for an int argument...

&gt;&gt;&gt; demo.generic_method(&quot;Hello, World!&quot;)
Implementation for a str argument...

&gt;&gt;&gt; demo.generic_method([1, 2, 3])
Do something with argument of type: list
</code></pre><p>Conclusion from website</p><ul><li>Simulate multiple constructors using optional arguments and type checking</li><li>Write multiple constructors using the built-in @classmethod decorator</li><li>Overload your class constructors using the @singledispatchmethod decorator</li></ul><h3 id=kubernetes-a-guide-to-kubernetes-architecture>[Kubernetes] A guide to Kubernetes architecture</h3><p><a href="https://opensource.com/article/22/2/kubernetes-architecture?utm_medium=Email&utm_campaign=weekly&sc_cid=7013a000002qKBKAA2">https://opensource.com/article/22/2/kubernetes-architecture?utm_medium=Email&utm_campaign=weekly&sc_cid=7013a000002qKBKAA2</a></p><p>ä»‹ç´¹ kubernetes å…ƒä»¶çš„æ¶æ§‹ï¼Œå¾ä¸­å¯ä»¥ç†è§£å…¶æ ¸å¿ƒï¼Œæ•£è½çš„ nodeï¼ŒåŠå¦‚ä½•å„ªåŒ–èª¿è¼ƒå°çš„æ–¹å‘</p><p>å¦‚æœæˆ‘ä¸€é–‹å§‹èƒ½çœ‹åˆ°é€™ç¯‡å°±çœäº†å¾ˆå¤šè·¯äº†ï¼Œä¸éä¹Ÿæœ‰å¯èƒ½èµ°äº†é‚£äº›è·¯ï¼Œæˆ‘æ‰çœ‹å¾—æ‡‚é€™ç¯‡ ãƒ½(âœ¿ï¾Ÿâ–½ï¾Ÿ)ãƒ</p><h3 id=python-string-encode-why-cant-you-reverse-a-string-with-a-flag-emoji>[Python-string-encode] Why Canâ€™t You Reverse a String With a Flag Emoji?</h3><p><a href=https://davidamos.dev/why-cant-you-reverse-a-flag-emoji/>https://davidamos.dev/why-cant-you-reverse-a-flag-emoji/</a></p><p>å¾ &ldquo;ğŸ‡ºğŸ‡¸&rdquo;[::-1] çš„çµæœï¼Œåæ¨åˆ° unicode åœ¨ python çš„å¯¦ä½œ</p><pre><code class="language-python=" data-lang="python=">&gt;&gt;&gt; &quot;ğŸ‡ºğŸ‡¸&quot;[::-1]
ğŸ‡¸ğŸ‡º
</code></pre><p>å¾ä¸Šé¢çš„ä¾‹å­å¯ç™¼ç¾ us flag ä¸æ˜¯ä½ æƒ³åƒä¸­çš„å–®ä¸€å­—å…ƒï¼Œè€Œæ˜¯å…©å€‹å­—å…ƒåˆåœ¨ä¸€èµ·ã€‚</p><p>æ¥ä¸‹ä¾†æˆ‘å€‘å˜—è©¦ç”¨ encode çš„æ–¹å¼å¾—åˆ°åŸç”Ÿçš„ unicodeï¼Œä¾†é¿æ‰å¯èƒ½æ˜¯ä¸åŒç·¨ç¢¼æ–¹å¼çš„éŒ¯èª¤ (ascii, utf-8, big5)</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=color:#f92672>&gt;&gt;&gt;</span> list(<span style=color:#e6db74>&#34;ğŸ‡ºğŸ‡¸&#34;</span><span style=color:#f92672>.</span>encode())
[<span style=color:#ae81ff>240</span>, <span style=color:#ae81ff>159</span>, <span style=color:#ae81ff>135</span>, <span style=color:#ae81ff>186</span>, <span style=color:#ae81ff>240</span>, <span style=color:#ae81ff>159</span>, <span style=color:#ae81ff>135</span>, <span style=color:#ae81ff>184</span>]
<span style=color:#f92672>&gt;&gt;&gt;</span> <span style=color:#75715e># ^^^^^^^^^^^^^^---Code point for ğŸ‡º</span>
<span style=color:#f92672>&gt;&gt;&gt;</span> <span style=color:#75715e>#                ^^^^^^^^^^^^^^^^^^---Code point for ğŸ‡¸</span>

<span style=color:#f92672>&gt;&gt;&gt;</span> <span style=color:#75715e># The code points get swapped!</span>
<span style=color:#f92672>&gt;&gt;&gt;</span> list(<span style=color:#e6db74>&#34;ğŸ‡ºğŸ‡¸&#34;</span>[::<span style=color:#f92672>-</span><span style=color:#ae81ff>1</span>]<span style=color:#f92672>.</span>encode())
[<span style=color:#ae81ff>240</span>, <span style=color:#ae81ff>159</span>, <span style=color:#ae81ff>135</span>, <span style=color:#ae81ff>184</span>, <span style=color:#ae81ff>240</span>, <span style=color:#ae81ff>159</span>, <span style=color:#ae81ff>135</span>, <span style=color:#ae81ff>186</span>]
<span style=color:#f92672>&gt;&gt;&gt;</span> <span style=color:#75715e># ^^^^^^^^^^^^^^---Code point for ğŸ‡¸</span>
<span style=color:#f92672>&gt;&gt;&gt;</span> <span style=color:#75715e>#                ^^^^^^^^^^^^^^^^^^---Code point for ğŸ‡º</span>
</code></pre></div><p>æˆåŠŸçš„ encode äº†ï¼Œç™¼ç¾ us flag ç¸½å…±åˆ†å‡ºäº†å…«å€‹å­—å…ƒï¼Œå››å€‹ç‚ºä¸€çµ„ï¼Œæ‰çµ„æˆäº† :us:ã€‚è€Œåœ¨ reverse ä¸­ï¼Œæ˜¯ä»¥ä¸€çµ„ç‚ºå–®ä½åš reverseï¼Œå› æ­¤æ‰å°è‡´ us -> suï¼Œè€Œæ­¤ su æ²’æœ‰è¾¦æ³•è§£ææˆ emoji çš„æ ¼å¼ï¼Œæ‰€ä»¥æ‰è·‘å‡ºåŸç”Ÿçš„å…©å€‹å­—</p><p>åŒç†èˆ‡ä¸­æ–‡å­—ç›¸åŒï¼Œä¸­æ–‡çš„æ¯å€‹å­—ä¹Ÿæ˜¯å¤šå€‹å­—å…ƒç‚ºä¸€çµ„ï¼Œä½†å› ç‚ºæ²’æœ‰åƒ emoji ä¸€æ¨£å¦å¤–å†è½‰ä¸€å±¤æŸ¥è©¢åšåœ–ç‰‡ï¼Œæ‰€ä»¥æ‰æ²’é‡å•é¡Œã€‚</p><p>æœ€å¾Œé™„ä¸Šæ–‡ä¸­ä½œè€…çš„æ•´ç†</p><ul><li>Strings of symbols get converted to sequences of integers by a character encoding, usually UTF-8.</li><li>Some characters are encoded as a single 8-bit integer by UTF-8, and others require two, three, or four 8-bit integers.</li><li>Some symbols, such as flag emojis, are not directly encoded by Unicode. Instead, they are renders of sequences of Unicode characters and may or may not be supported by every platform.</li></ul><p>å…§æ–‡é‚„æœ‰è¬›åˆ°æ›´å¤š bits çš„</p><h2 id=others>Others</h2><h3 id=python-what-does--noqa-mean-in-python-comments>[python] What does &lsquo;# noqa&rsquo; mean in Python comments</h3><p><a href=https://stackoverflow.com/questions/45346575/what-does-noqa-mean-in-python-comments>https://stackoverflow.com/questions/45346575/what-does-noqa-mean-in-python-comments</a></p><p>noqa = NO-QA -> no quality assurance</p><p>linter ä¸æœƒæª¢æŸ¥é€™è¡Œ code å–”~ åƒæ˜¯ flake8</p><h3 id=mock-mocking-a-class-used-in-a-with-statement>[mock] Mocking a class used in a with statement</h3><p><a href=https://stackoverflow.com/questions/54634817/mocking-a-class-used-in-a-with-statement>https://stackoverflow.com/questions/54634817/mocking-a-class-used-in-a-with-statement</a></p><pre><code class="language-python=" data-lang="python=">with conn.cursor() as cursor:
    cursor.execute('select 1')
    if not cursor.rowcount:
        raise ValueError('No object found')
    result = cursor.fetchone()
</code></pre><p>ç¬¬ä¸€å€‹ return_value å–å‡º <code>conn.cursor()</code> çš„å›å‚³
ç¬¬äºŒå€‹ return_value å‰‡æ˜¯ with statement çš„å…§å»ºå‡½æ•¸ <code>__enter__</code> è£¡çš„å›å‚³é … <code>def __enter__(self)</code></p><pre><code class="language-python=" data-lang="python=">mock = Mock()
mock_cursor = mock.conn.cursor.return_value.__enter__.return_value
mock_cursor.rowcount = 1
mock_cursor.fetchone = ('a',)
</code></pre><h3 id=python-psycopg2-where-in-statement-parameters>[python] psycopg2 where in statement parameters</h3><p><a href=https://stackoverflow.com/questions/28117576/python-psycopg2-where-in-statement>https://stackoverflow.com/questions/28117576/python-psycopg2-where-in-statement</a></p><pre><code class="language-python=" data-lang="python=">data = ('UK', 'France')

sql = 'SELECT * FROM countries WHERE country in %s'
cur.execute(sql, (data,))
</code></pre><ol><li>ä½¿ç”¨ tuple ä¾†å‚³é parameters</li><li>ä½¿ç”¨ <code>in %s</code> ä¸èƒ½ç”¨æ‹¬è™Ÿ <code>in (%s)</code> ï¼Œç³»çµ±æœƒä»¥ç‚º <code>(('UK', 'France'),)</code></li></ol><h3 id=kubernetes-ç¬¬ä¸€åƒé›¶ä¸€ç¯‡çš„-cgroups-ä»‹ç´¹>[kubernetes] ç¬¬ä¸€åƒé›¶ä¸€ç¯‡çš„ cgroups ä»‹ç´¹</h3><p><a href=https://medium.com/starbugs/%E7%AC%AC%E4%B8%80%E5%8D%83%E9%9B%B6%E4%B8%80%E7%AF%87%E7%9A%84-cgroups-%E4%BB%8B%E7%B4%B9-a1c5005be88c>https://medium.com/starbugs/%E7%AC%AC%E4%B8%80%E5%8D%83%E9%9B%B6%E4%B8%80%E7%AF%87%E7%9A%84-cgroups-%E4%BB%8B%E7%B4%B9-a1c5005be88c</a></p><p>å°é€™å€‹æ²’æœ‰å¾ˆç†Ÿï¼Œä½†ç¨å¾®å¼·è¿«è‡ªå·±å¸æ”¶é» (ä½†ä¸‹é¢å°±çœ‹ä¸å¤ªæ‡‚äº† Ù©(Åï¹Åã€)Û¶</p><ul><li>å¯é™åˆ¶æ§åˆ¶éš”é›¢ process æ‰€ä½¿ç”¨åˆ°çš„ç³»çµ±è³‡æºï¼Œä¾‹å¦‚ CPU, memory, Disk I/O, Network&mldr;ç­‰</li><li>Resource limiting, Prioritization, Accounting, Control</li><li>2006 process containers -> 2007 cgroups v1 -> 2016 cgroups v2</li><li>cgroups æ²’æœ‰ API/library çš„æ“ä½œæ–¹å¼ï¼Œæ˜¯é€é Linux Virtual File System å¯¦ä½œï¼Œå¯åƒæª”æ¡ˆç³»çµ±ä¸€æ¨£ï¼Œé€éæ–°å¢ä¿®æ”¹åˆªé™¤è³‡æ–™å¤¾æª”æ¡ˆä¾†è¨­å®š</li><li>è«‹ä½¿ç”¨ systemd unit ä¾†ç®¡ç† cgroupï¼Œèº«ç‚º linux distribution é è¨­çš„ç³»çµ±ç®¡ç†æœå‹™ï¼Œä¹Ÿæ˜¯å¤§å®¶ç†Ÿæ‚‰ç¿’æ…£çš„ï¼Œè«‹ä½¿ç”¨å®ƒ!</li></ul><h3 id=fastapi-events-startup---shutdown>[FastAPI] events: startup - shutdown</h3><p><a href=https://fastapi.tiangolo.com/advanced/events/>https://fastapi.tiangolo.com/advanced/events/</a></p><pre><code class="language-python=" data-lang="python=">@app.on_event('startup')
async def startup_event():
    ...
</code></pre><p>åœ¨ application æ­£å¼é‹è¡Œå‰åŸ·è¡Œ (å¯ä»¥å¤šå€‹ startup eventï¼Œrequests æœƒç­‰å…¨éƒ¨çš„ startup event çµæŸå¾Œæ‰æœƒé–‹å§‹æ¥æ”¶)ï¼Œåƒæ˜¯é€£æ¥ database ç”¢ç”Ÿåˆå§‹è³‡æ–™</p><pre><code class="language-python=" data-lang="python=">@app.on_event('shutdown')
def shutdown_event():
    with open('log.txt', mode='a') as log:
        log.write('Application shutdown')
</code></pre><p>åœ¨ application è¢«é—œé–‰å¾Œï¼Œå¯ä»¥åšé»åƒæ˜¯æ¸…ç† cache æˆ–å¯«å…¥ç´€éŒ„ã€‚<br>ä¸Šé¢çš„ä¾‹å­ï¼Œæ˜¯å°‡é—œé–‰è³‡è¨Šå¯«å…¥æª”æ¡ˆï¼Œåˆ©ç”¨ <code>open()</code> ä¸æ”¯æ´ async/awaitï¼Œæ‰€æœ‰æ˜¯ä½¿ç”¨ <code>def</code> è€Œä¸æ˜¯ <code>async def</code></p><h3 id=fastapi-request-body--path--query-parameters>[FastAPI] Request body + path + query parameters</h3><p><a href=https://fastapi.tiangolo.com/tutorial/body/#request-body-path-query-parameters>https://fastapi.tiangolo.com/tutorial/body/#request-body-path-query-parameters</a></p><pre><code class="language-python=" data-lang="python=">from typing import Optional

from fastapi import FastAPI
from pydantic import BaseModel


class Item(BaseModel):
    name: str
    description: Optional[str] = None
    price: float
    tax: Optional[float] = None


app = FastAPI()


@app.put(&quot;/items/{item_id}&quot;)
async def create_item(item_id: int, item: Item, q: Optional[str] = None):
    result = {&quot;item_id&quot;: item_id, **item.dict()}
    if q:
        result.update({&quot;q&quot;: q})
    return result
</code></pre><ul><li><code>{item_id}</code> æ˜¯ path parameter</li><li><code>q</code> query parameter (singular type)</li><li><code>item</code> å‰‡æ˜¯ pydantic model -> request body</li></ul><p><a href=https://fastapi.tiangolo.com/tutorial/body-multiple-params/#embed-a-single-body-parameter>https://fastapi.tiangolo.com/tutorial/body-multiple-params/#embed-a-single-body-parameter</a>
-> ä½¿ç”¨ <code>Body</code> ä¾†æ›´å®Œå–„ request body çš„è¦æ±‚åŠ openapi çš„ specï¼Œåƒæ˜¯ example</p><pre><code class="language-python=" data-lang="python=">class Item(BaseModel):
    name: str
    description: Optional[str] = None
    price: float
    tax: Optional[float] = None
    
@app.put(&quot;/items/{item_id}&quot;)
async def update_item(item_id: int, item: Item = Body(..., embed=True)):
    results = {&quot;item_id&quot;: item_id, &quot;item&quot;: item}
    return results
</code></pre><p>å¤šåŠ å…¥ <code>embed=True</code></p><pre><code class="language-json=" data-lang="json=">{
    &quot;name&quot;: &quot;Foo&quot;,
    &quot;description&quot;: &quot;The pretender&quot;,
    &quot;price&quot;: 42.0,
    &quot;tax&quot;: 3.2
}
</code></pre><p>-> è®Šæˆéœ€è¦é¡å¤–åŠ å…¥ <code>item</code> ä½œç‚º key</p><pre><code class="language-json=" data-lang="json=">{
    &quot;item&quot;: {
        &quot;name&quot;: &quot;Foo&quot;,
        &quot;description&quot;: &quot;The pretender&quot;,
        &quot;price&quot;: 42.0,
        &quot;tax&quot;: 3.2
    }
}
</code></pre><h3 id=fastapi-body-with-multiple-examples>[FastAPI] <code>Body</code> with multiple <code>examples</code></h3><p><a href=https://fastapi.tiangolo.com/tutorial/schema-extra-example/#body-with-multiple-examples>https://fastapi.tiangolo.com/tutorial/schema-extra-example/#body-with-multiple-examples</a></p><p>fastapi çš„ example è®“ä½ å¯ä»¥åœ¨ swagger ä¸Šé¢ï¼Œæœ‰äº›é è¨­çš„ request body/parameter å¯ä»¥é¸æ“‡åŠåƒè€ƒ~ å¾ˆæ–¹ä¾¿</p><p>é€™é‚Šè¬›çš„ examples ä¸æ˜¯å–®ç´”æŒ‡ bodyï¼Œé‚„å¯ä»¥ç”¨åœ¨</p><ul><li>Path()</li><li>Query()</li><li>Header()</li><li>Cookie()</li><li>Body()</li><li>Form()</li><li>File()</li></ul><p>å–®ä¸€çš„ example: <code>example=&lt;ä½ æƒ³è¦å‘ˆç¾çš„ä¾‹å­></code></p><pre><code class="language-python=" data-lang="python=">@app.put(&quot;/items/{item_id}&quot;)
async def update_item(
    item_id: int,
    item: Item = Body(
        ...,
        example={
            &quot;name&quot;: &quot;Foo&quot;,
            &quot;description&quot;: &quot;A very nice Item&quot;,
            &quot;price&quot;: 35.4,
            &quot;tax&quot;: 3.2,
        },
    ),
):
    results = {&quot;item_id&quot;: item_id, &quot;item&quot;: item}
    return results
</code></pre><p>å¤šå€‹ examplesï¼Œä½ å¯ä»¥å®šç¾©æ›´å¤šçš„è³‡è¨Šï¼Œç”šè‡³é‚„æœ‰ä¸‹æ‹‰é¸å–®!!</p><ul><li>summary: ä¸‹æ‹‰é¸å–®çš„é¸é …åç¨±</li><li>description: æ›´è©³ç´°çš„æè¿°ï¼Œæ”¯æ´ markdown</li><li>value: è¦ç•¶ä½œ example çš„å€¼</li><li>externalValues: alternative to value, a URL pointing to the example. Although this might not be supported by as many tools as value.</li></ul><pre><code class="language-python=" data-lang="python=">@app.put(&quot;/items/{item_id}&quot;)
async def update_item(
    *,
    item_id: int,
    item: Item = Body(
        ...,
        examples={
            &quot;normal&quot;: {
                &quot;summary&quot;: &quot;A normal example&quot;,
                &quot;description&quot;: &quot;A **normal** item works correctly.&quot;,
                &quot;value&quot;: {
                    &quot;name&quot;: &quot;Foo&quot;,
                    &quot;description&quot;: &quot;A very nice Item&quot;,
                    &quot;price&quot;: 35.4,
                    &quot;tax&quot;: 3.2,
                },
            },
            &quot;converted&quot;: {
                &quot;summary&quot;: &quot;An example with converted data&quot;,
                &quot;description&quot;: &quot;FastAPI can convert price `strings` to actual `numbers` automatically&quot;,
                &quot;value&quot;: {
                    &quot;name&quot;: &quot;Bar&quot;,
                    &quot;price&quot;: &quot;35.4&quot;,
                },
            },
            &quot;invalid&quot;: {
                &quot;summary&quot;: &quot;Invalid data is rejected with an error&quot;,
                &quot;value&quot;: {
                    &quot;name&quot;: &quot;Baz&quot;,
                    &quot;price&quot;: &quot;thirty five point four&quot;,
                },
            },
        },
    ),
):
    results = {&quot;item_id&quot;: item_id, &quot;item&quot;: item}
    return results
</code></pre><h3 id=fastapi-middleware>[FastAPI] middleware</h3><p><a href=https://fastapi.tiangolo.com/tutorial/middleware/>https://fastapi.tiangolo.com/tutorial/middleware/</a></p><p>ä½ å¯ä»¥å®¢è£½è‡ªå·±çš„ middleware</p><pre><code class="language-python=" data-lang="python=">import time

from fastapi import FastAPI, Request

app = FastAPI()


@app.middleware(&quot;http&quot;)
async def add_process_time_header(request: Request, call_next):
    start_time = time.time()
    response = await call_next(request)
    process_time = time.time() - start_time
    response.headers[&quot;X-Process-Time&quot;] = str(process_time)
    return response

</code></pre><h3 id=designpattern-wiki-ä¸Šé¢çš„-design-pattern>[DesignPattern] Wiki ä¸Šé¢çš„ design pattern</h3><p><a href=https://en.wikipedia.org/wiki/Software_design_pattern#Classification_and_list>https://en.wikipedia.org/wiki/Software_design_pattern#Classification_and_list</a></p><p>ç™¼ç¾ wiki ä¸Šé¢çš„é‚„è »å®Œæ•´çš„æ¤°</p><h3 id=systemstructure-uml>[SystemStructure] UML</h3><p><a href=https://zh.wikipedia.org/wiki/%E7%BB%9F%E4%B8%80%E5%BB%BA%E6%A8%A1%E8%AF%AD%E8%A8%80>https://zh.wikipedia.org/wiki/%E7%BB%9F%E4%B8%80%E5%BB%BA%E6%A8%A1%E8%AF%AD%E8%A8%80</a></p><p>æè¿°è»Ÿé«”å°ˆæ¡ˆæ¶æ§‹</p><ul><li>class diagram <a href=https://zh.wikipedia.org/wiki/%E9%A1%9E%E5%88%A5%E5%9C%96>https://zh.wikipedia.org/wiki/%E9%A1%9E%E5%88%A5%E5%9C%96</a></li><li>sequence diagram <a href=https://zh.wikipedia.org/wiki/%E6%97%B6%E5%BA%8F%E5%9B%BE>https://zh.wikipedia.org/wiki/%E6%97%B6%E5%BA%8F%E5%9B%BE</a></li><li>use case diagram <a href=https://zh.wikipedia.org/wiki/%E7%94%A8%E4%BE%8B%E5%9B%BE>https://zh.wikipedia.org/wiki/%E7%94%A8%E4%BE%8B%E5%9B%BE</a></li></ul><h3 id=psycopg2-sqlstate-exception-classes>[psycopg2] Sqlstate exception classes</h3><p><a href=https://www.psycopg.org/docs/errors.html#sqlstate-exception-classes>https://www.psycopg.org/docs/errors.html#sqlstate-exception-classes</a></p><h1 id=notes>Notes</h1><h2 id=regular-expression-å–å‡º>Regular expression å–å‡º</h2><pre><code class="language-python=" data-lang="python=">import re

match = re.match(r'[name|id]: [0-9]{1,5}', text)
if not match:
    print('no match')
else:
    end = match.span()[1]
    
</code></pre><h2 id=mock-setting-return-values-and-attributes>[Mock] setting return values and attributes</h2><h3 id=set-function-return-value>set function return value</h3><pre><code class="language-python=" data-lang="python=">&gt;&gt;&gt; mock = Mock()
&gt;&gt;&gt;mock.return_value = 5
&gt;&gt;&gt; mock()
5
</code></pre><h3 id=set-module-return-value>Set module return value</h3><pre><code class="language-python=" data-lang="python=">&gt;&gt;&gt; mock = Mock()
&gt;&gt;&gt; mock.method.return_value = 5
&gt;&gt;&gt; mock.method()
5
</code></pre><h3 id=set-attribute-value>set attribute value</h3><pre><code class="language-python=" data-lang="python=">&gt;&gt;&gt; mock = Mock()
&gt;&gt;&gt; mock.x = 5
&gt;&gt;&gt; mock.x
5
</code></pre><h3 id=use-class-instance>use class instance</h3><ol><li>å¯¦é«”åŒ–</li></ol><pre><code class="language-python=" data-lang="python=">&gt;&gt;&gt; mock = Mock()
&gt;&gt;&gt; cursor = mock.connect.cursor.return_value
</code></pre><pre><code class="language-python=" data-lang="python=">cursor = connect.cursor()
</code></pre><ol start=2><li>é‡å°å¯¦é«”åŒ–çš„ç‰©ä»¶</li></ol><pre><code class="language-python=" data-lang="python=">&gt;&gt;&gt; mock = Mock()
&gt;&gt;&gt; cursor = mock.connect.cursor.return_value
&gt;&gt;&gt; cursor.execute.return_value = ['foo']
&gt;&gt;&gt; cursor.rowcount = 3
</code></pre><pre><code class="language-python=" data-lang="python=">&gt;&gt;&gt; cursor = connect.cursor()
&gt;&gt;&gt; cursor.execute('select 1')
['foo']
&gt;&gt;&gt; cursor.rowcount
3
</code></pre><h2 id=fastapi-additional-responses-in-openapi>[FastAPI] Additional responses in OpenAPI</h2><p><a href=https://fastapi.tiangolo.com/advanced/additional-responses/>https://fastapi.tiangolo.com/advanced/additional-responses/</a></p><pre><code class="language-python=" data-lang="python=">from fastapi import FastAPI
from fastapi.responses import JSONResponse
from pydantic import BaseModel


class Item(BaseModel):
    id: str
    value: str


class Message(BaseModel):
    message: str


app = FastAPI()


@app.get(&quot;/items/{item_id}&quot;, response_model=Item, responses={404: {&quot;model&quot;: Message}})
async def read_item(item_id: str):
    if item_id == &quot;foo&quot;:
        return {&quot;id&quot;: &quot;foo&quot;, &quot;value&quot;: &quot;there goes my hero&quot;}
    else:
        return JSONResponse(status_code=404, content={&quot;message&quot;: &quot;Item not found&quot;})
</code></pre><p><code>@app.get(..., responses)</code> å®šç¾© model æ™‚ï¼Œå¯ä»¥åˆ©ç”¨ content çš„ keyword parameter ä¾†å¡å…¥ pydantic model ä½œç‚ºè¼¸å‡ºçš„æ ¼å¼ï¼ŒåŒæ™‚ä¹Ÿæœƒé¡¯ç¤ºåœ¨ openapi swagger ä¸Šé¢ã€‚</p><p>å¦‚æœä¸æƒ³è¦é‚£éº¼éº»ç…©ï¼Œå°±å¯«å€‹ description ä¾†æè¿°è©²ç‹€æ…‹çš„éŒ¯èª¤</p><blockquote><p>è‡³æ–¼ httpexceptions / jsonresponse ä¸çŸ¥é“æœ‰ä»€éº¼å·®åˆ¥ QQ å¯èƒ½ä¸€å€‹æ˜¯ç”¨ raise?</p></blockquote></div></div><div id=post-footer class="post-footer main-content-wrap"><div class=post-footer-tags><span class="text-color-light text-small">æ¨™ç±¤</span><br><a class="tag tag--primary tag--small" href=https://sean2249.github.io/tags/weekly/>weekly</a></div><div class=post-actions-wrap><nav><ul class="post-actions post-action-nav"><li class=post-action><a class="post-action-btn btn btn--default tooltip--top" href=https://sean2249.github.io/posts/weekly_05/ data-tooltip=Weekly_05 aria-label="ä¸‹ä¸€ç¯‡: Weekly_05"><i class="fa fa-angle-left"></i><span class="hide-xs hide-sm text-small icon-ml">ä¸‹ä¸€ç¯‡</span></a></li><li class=post-action><a class="post-action-btn btn btn--default tooltip--top" href=https://sean2249.github.io/posts/weekly_03/ data-tooltip=Weekly_03 aria-label="ä¸Šä¸€ç¯‡: Weekly_03"><span class="hide-xs hide-sm text-small icon-mr">ä¸Šä¸€ç¯‡</span>
<i class="fa fa-angle-right"></i></a></li></ul></nav><ul class="post-actions post-action-share"><li class="post-action hide-lg hide-md hide-sm"><a class="post-action-btn btn btn--default btn-open-shareoptions" href=#btn-open-shareoptions aria-label=åˆ†äº«é€™å€‹å¸–å­><i class="fa fa-share-alt" aria-hidden=true></i></a></li><li class="post-action hide-xs"><a class="post-action-btn btn btn--default" target=new href="https://www.facebook.com/sharer/sharer.php?u=https://sean2249.github.io/posts/weekly_04/" title="åˆ†äº«åˆ° Facebook" aria-label="åˆ†äº«åˆ° Facebook"><i class="fab fa-facebook-square" aria-hidden=true></i></a></li><li class="post-action hide-xs"><a class="post-action-btn btn btn--default" target=new href="https://twitter.com/intent/tweet?text=https://sean2249.github.io/posts/weekly_04/" title="åˆ†äº«åˆ° Twitter" aria-label="åˆ†äº«åˆ° Twitter"><i class="fab fa-twitter" aria-hidden=true></i></a></li><li class="post-action hide-xs"><a class="post-action-btn btn btn--default" target=new href="https://www.linkedin.com/sharing/share-offsite/?url=https://sean2249.github.io/posts/weekly_04/" title="åˆ†äº«åˆ° Linkedin" aria-label="åˆ†äº«åˆ° Linkedin"><i class="fab fa-linkedin" aria-hidden=true></i></a></li><li class=post-action><a class="post-action-btn btn btn--default" href=#disqus_thread aria-label=ç™¼è¡¨è©•è«–><i class="far fa-comment"></i></a></li><li class=post-action><a class="post-action-btn btn btn--default" href=#top aria-label=å›åˆ°é ‚éƒ¨><i class="fa fa-arrow-up" aria-hidden=true></i></a></li></ul></div><div id=disqus_thread><noscript>Please enable JavaScript to view the comments powered by Disqus.</noscript></div><script type=text/javascript>var disqus_config=function(){this.page.url='https://sean2249.github.io/posts/weekly_04/',this.page.identifier='/posts/weekly_04/'};(function(){var a,b;if(["localhost","127.0.0.1"].indexOf(window.location.hostname)!=-1){document.getElementById('disqus_thread').innerHTML='Disqus comments not available by default when the website is previewed locally.';return}a=document.createElement('script'),a.type='text/javascript',a.async=!0,b='hugo-tranquilpeak-theme',a.src='//'+b+'.disqus.com/embed.js',(document.getElementsByTagName('head')[0]||document.getElementsByTagName('body')[0]).appendChild(a)})()</script></div></article><footer id=footer class=main-content-wrap><span class=copyrights>&copy; 2022 Kiwi Lee. All Rights Reserved</span></footer></div><div id=bottom-bar class=post-bottom-bar data-behavior=5><div class=post-actions-wrap><nav><ul class="post-actions post-action-nav"><li class=post-action><a class="post-action-btn btn btn--default tooltip--top" href=https://sean2249.github.io/posts/weekly_05/ data-tooltip=Weekly_05 aria-label="ä¸‹ä¸€ç¯‡: Weekly_05"><i class="fa fa-angle-left"></i><span class="hide-xs hide-sm text-small icon-ml">ä¸‹ä¸€ç¯‡</span></a></li><li class=post-action><a class="post-action-btn btn btn--default tooltip--top" href=https://sean2249.github.io/posts/weekly_03/ data-tooltip=Weekly_03 aria-label="ä¸Šä¸€ç¯‡: Weekly_03"><span class="hide-xs hide-sm text-small icon-mr">ä¸Šä¸€ç¯‡</span>
<i class="fa fa-angle-right"></i></a></li></ul></nav><ul class="post-actions post-action-share"><li class="post-action hide-lg hide-md hide-sm"><a class="post-action-btn btn btn--default btn-open-shareoptions" href=#btn-open-shareoptions aria-label=åˆ†äº«é€™å€‹å¸–å­><i class="fa fa-share-alt" aria-hidden=true></i></a></li><li class="post-action hide-xs"><a class="post-action-btn btn btn--default" target=new href="https://www.facebook.com/sharer/sharer.php?u=https://sean2249.github.io/posts/weekly_04/" title="åˆ†äº«åˆ° Facebook" aria-label="åˆ†äº«åˆ° Facebook"><i class="fab fa-facebook-square" aria-hidden=true></i></a></li><li class="post-action hide-xs"><a class="post-action-btn btn btn--default" target=new href="https://twitter.com/intent/tweet?text=https://sean2249.github.io/posts/weekly_04/" title="åˆ†äº«åˆ° Twitter" aria-label="åˆ†äº«åˆ° Twitter"><i class="fab fa-twitter" aria-hidden=true></i></a></li><li class="post-action hide-xs"><a class="post-action-btn btn btn--default" target=new href="https://www.linkedin.com/sharing/share-offsite/?url=https://sean2249.github.io/posts/weekly_04/" title="åˆ†äº«åˆ° Linkedin" aria-label="åˆ†äº«åˆ° Linkedin"><i class="fab fa-linkedin" aria-hidden=true></i></a></li><li class=post-action><a class="post-action-btn btn btn--default" href=#disqus_thread aria-label=ç™¼è¡¨è©•è«–><i class="far fa-comment"></i></a></li><li class=post-action><a class="post-action-btn btn btn--default" href=#top aria-label=å›åˆ°é ‚éƒ¨><i class="fa fa-arrow-up" aria-hidden=true></i></a></li></ul></div></div><div id=share-options-bar class=share-options-bar data-behavior=5><i id=btn-close-shareoptions class="fa fa-times"></i><ul class=share-options><li class=share-option><a class=share-option-btn target=new href="https://www.facebook.com/sharer/sharer.php?u=https%3A%2F%2Fsean2249.github.io%2Fposts%2Fweekly_04%2F" aria-label="åˆ†äº«åˆ° Facebook"><i class="fab fa-facebook-square" aria-hidden=true></i><span>åˆ†äº«åˆ° Facebook</span></a></li><li class=share-option><a class=share-option-btn target=new href="https://twitter.com/intent/tweet?text=https%3A%2F%2Fsean2249.github.io%2Fposts%2Fweekly_04%2F" aria-label="åˆ†äº«åˆ° Twitter"><i class="fab fa-twitter" aria-hidden=true></i><span>åˆ†äº«åˆ° Twitter</span></a></li><li class=share-option><a class=share-option-btn target=new href="https://www.linkedin.com/sharing/share-offsite/?url=https%3A%2F%2Fsean2249.github.io%2Fposts%2Fweekly_04%2F" aria-label="åˆ†äº«åˆ° Linkedin"><i class="fab fa-linkedin" aria-hidden=true></i><span>åˆ†äº«åˆ° Linkedin</span></a></li></ul></div><div id=share-options-mask class=share-options-mask></div></div><div id=about><div id=about-card><div id=about-btn-close><i class="fa fa-times"></i></div><img id=about-card-picture src="https://www.gravatar.com/avatar/0d1e46158977211ef53c1d7c007415f6?s=110" alt=ä½œè€…çš„åœ–ç‰‡><h4 id=about-card-name>Kiwi Lee</h4><div id=about-card-bio>Python engineer/Devops</div><div id=about-card-job><i class="fa fa-briefcase"></i><br>Devops engineer</div><div id=about-card-location><i class="fa fa-map-marker-alt"></i><br>Taiwan</div></div></div><div id=cover style=background-image:url(https://sean2249.github.io/images/cover2.jpg)></div><script src=https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js integrity="sha512-894YE6QWD5I59HgZOGReFYm4dnWc1Qt5NtvYSaNcOP+u1T9qYdvdihz0PPSiiqn/+/3e7Jo4EaG7TubfWGUrMQ==" crossorigin=anonymous referrerpolicy=no-referrer></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.1.0/highlight.min.js integrity="sha512-z+/WWfyD5tccCukM4VvONpEtLmbAm5LDu7eKiyMQJ9m7OfPEDL7gENyDRL3Yfe8XAuGsS2fS4xSMnl6d30kqGQ==" crossorigin=anonymous referrerpolicy=no-referrer></script><script src=https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.7/jquery.fancybox.min.js integrity="sha512-uURl+ZXMBrF4AwGaWmEetzrd+J5/8NRkWAvJx5sbPSSuOb0bZLqf+tOzniObO00BjHa/dD7gub9oCGMLPQHtQA==" crossorigin=anonymous referrerpolicy=no-referrer></script><script src=https://sean2249.github.io/js/script-yqzy9wdlzix4lbbwdnzvwx3egsne77earqmn73v9uno8aupuph8wfguccut.min.js></script><script async crossorigin=anonymous defer integrity="sha512-gE8KAQyFIzV1C9+GZ8TKJHZS2s+n7EjNtC+IMRn1l5+WYJTHOODUM6JSjZhFhqXmc7bG8Av6XXpckA4tYhflnw==" src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.1.0/languages/apache.min.js></script><script async crossorigin=anonymous defer integrity="sha512-EWROca+bote+7Oaaar1F6y74iZj1r1F9rm/ly7o+/FwJopbBaWtsFDmaKoZDd3QiGU2pGacBirHJNivmGLYrow==" src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.1.0/languages/go.min.js></script><script async crossorigin=anonymous defer integrity="sha512-GDVzAn0wpx1yVtQsRWmFc6PhJiLBPdUic+h4GWgljBh904O3JU10fk9EKNpVyIoPqkFn54rgL2QBG4BmUTMpiQ==" src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.1.0/languages/http.min.js></script><script async crossorigin=anonymous defer integrity="sha512-UgZlma8NzkrDb/NWgmLIcTrH7i/CSnLLDRFqCSNF5NGPpjKmzyM25qcoXGOup8+cDakKyaiTDd7N4dyH4YT+IA==" src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.1.0/languages/less.min.js></script><script async crossorigin=anonymous defer integrity="sha512-lot9koe73sfXIrUvIPM/UEhuMciN56RPyBdOyZgfO53P2lkWyyXN7J+njcxIIBRV+nVDQeiWtiXg+bLAJZDTfg==" src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.1.0/languages/nginx.min.js></script><script async crossorigin=anonymous defer integrity="sha512-Zd3e7XxHP00TD0Imr0PIfeM0fl0v95kMWuhyAS3Wn1UTSXTkz0OhtRgBAr4JlmADRgiXr4x7lpeUdqaGN8xIog==" src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.1.0/languages/puppet.min.js></script><script async crossorigin=anonymous defer integrity="sha512-qtqDO052iXMSP+5d/aE/jMtL9vIIGvONgTJziC2K/ZIB1yEGa55WVxGE9/08rSQ62EoDifS9SWVGZ7ihSLhzMA==" src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.1.0/languages/scss.min.js></script><script async crossorigin=anonymous defer integrity="sha512-1NmkjnEDnwwwcu28KoQF8vs3oaPFokQHbmbtwGhFfeDsQZtVFI8zW2aE9O8yMYdpdyKV/5blE4pSWw4Z/Sv97w==" src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.1.0/languages/stylus.min.js></script><script async crossorigin=anonymous defer integrity="sha512-B2wSfruPjr8EJL6IIzQr1eAuDwrsfIfccNf/LCEdxELCgC/S/ZMt/Uvk80aD79m7IqOqW+Sw8nbkvha20yZpzg==" src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.1.0/languages/swift.min.js></script><script async crossorigin=anonymous defer integrity="sha512-28oDiQZGKUVN6wQ7PSLPNipOcmkCALXKwOi7bnkyFf8QiMZQxG9EQoy/iiNx6Zxj2cG2SbVa4dXKigQhu7GiFw==" src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.1.0/languages/yaml.min.js></script><script>$(document).ready(function(){hljs.configure({classPrefix:'',useBR:!1}),$('pre.code-highlight > code, pre > code').each(function(b,a){$(this).hasClass('codeblock')||$(this).addClass('codeblock'),hljs.highlightBlock(a)})})</script></body></html>